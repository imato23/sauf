<div class="container" fxLayout="column" fxLayoutGap="20px">
    <!-- toolbar-->
    <div>
        <mat-toolbar color="primary">
            <button type="button" aria-label="Toggle sidenav" mat-icon-button [routerLink]="['/wines/wine-list']">
                <mat-icon aria-label="Side nav toggle icon">arrow_back</mat-icon>
            </button>
            <span>{{wineFormGroup.value.name}}</span>
            <span class="toolbar-spacer"></span>
            <button mat-icon-button aria-label="Save" (click)="onSave()" [disabled]="!wineFormGroup.valid">
                <mat-icon>save</mat-icon>
            </button>
            <button mat-icon-button aria-label="More" [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
            </button>
        </mat-toolbar>
    </div>

    <!-- content -->
    <div class="content-container" fxFlex="auto" fxLayout="row" fxLayout.xs="column" fxLayoutGap="20px">

        <!-- image-->
        <div fxLayout="row" fxLayoutAlign="center stretch" fxFlexAlign="stretch">
            <div class="image-container">
                <img *ngIf="currentImage" [src]="currentImage" class="wine-image" />
                <div *ngIf="!currentImage" class="wine-image" style="width: 300px; border: 1px dashed;"
                    fxLayoutAlign="center center">
                    <div i18n="NoImageAvailable">No image available</div>
                </div>
                <div class="image-floating-action-button">
                    <button mat-mini-fab color="accent" (click)=onCaptureImage()>
                        <mat-icon>photo_camera</mat-icon>
                    </button>
                </div>
            </div>
        </div>

        <!-- form -->
        <div fxFlex>
            <div [formGroup]="wineFormGroup" *ngIf="(wine$ | async) as wine; else loading">
                <h3>Allgemeines</h3>
                <mat-form-field>
                    <mat-label i18n="@@WineName">Name</mat-label>
                    <input matInput formControlName="name" required>
                </mat-form-field>
                <br>
                <mat-form-field>
                    <mat-label i18n="@@WineCategory2|WineCategory">Category</mat-label>
                    <mat-select formControlName="category" required readonly>
                        <mat-option *ngFor="let category of categories$ | async" value="{{category}}"
                            i18n="@@WineCategory">
                            {category, select, redWine {RedWine} whiteWine {WhiteWine} roseWine {RoseWine} sparklingWine
                            {SparklingWine}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <br>
                <mat-form-field>
                    <mat-label i18n="@@WineProducer">Producer</mat-label>
                    <input matInput formControlName="producer" required>
                </mat-form-field>
                <br>
                <mat-form-field>
                    <mat-label i18n="@@Country">Country</mat-label>
                    <input matInput formControlName="country" required>
                </mat-form-field>
                <br>
                <mat-form-field>
                    <mat-label i18n="@@Region">Region</mat-label>
                    <input matInput formControlName="region" required>
                </mat-form-field>

                <!-- vintages -->
                <h3>Jahrgänge</h3>
                <mat-nav-list>
                    <ng-container *ngFor="let vintageInfo of wine.vintageInfos">
                        <mat-list-item routerLink="/wines/view-vintage/{{wine._id}}/{{vintageInfo.vintage}}">
                            <h3 matLine>{{vintageInfo.vintage}}</h3>
                            <div fxLayout="row">
                                <div fxFlex i18n="@@Bottles2">{vintageInfo.numberOfBottles,
                                    plural, =1 {{{vintageInfo.numberOfBottles}} Bottle} other {{{vintageInfo.numberOfBottles}} Bottles}}</div>
                            </div>
                        </mat-list-item>
                        <mat-divider></mat-divider>
                    </ng-container>
                </mat-nav-list>
                <button mat-button color="accent" routerLink="/wines/add-vintage/{{wine._id}}">Jahrgang hinzufügen</button>
            </div>

            <ng-template #loading i18n="@@LoadingWine">
                Loading wine...
            </ng-template>
        </div>
    </div>
</div>

<mat-menu #menu="matMenu">
    <button mat-menu-item (click)="onDelete()" [disabled]="!wineId">
        <mat-icon>delete</mat-icon>
        <span i18n="@@DeleteWine">Delete wine</span>
    </button>
</mat-menu>